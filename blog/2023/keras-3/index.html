<!DOCTYPE html> <html lang="kr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Keras 3.0 설명 | Wonbeom Jang </title> <meta name="author" content="Wonbeom Jang"> <meta name="description" content="개발을 좋아하는 딥러닝 리서쳐 장원범입니다. "> <meta name="keywords" content="computer-vision, machine-learning, software-engineer, software-engineering"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://www.wonbeomjang.kr/blog/2023/keras-3/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Wonbeom </span> Jang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Keras 3.0 설명</h1> <p class="post-meta"> December 03, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/framework"> <i class="fa-solid fa-hashtag fa-sm"></i> framework</a>     ·   <a href="/blog/category/framework"> <i class="fa-solid fa-tag fa-sm"></i> framework</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="why">Why?</h1> <p>과거 keras는 Tensorflow, Theano, MXNet등 여러 deep learning backend framework가 있을 때 multi-backend 지원의 강점을 가지며 출시되었다. 하지만 Teano와 MXNet등 여러 framework들은 쇄퇴의 길을 걸었고, tensorflow만 살아남게 되었다. 하지만 당시 tensorflow도 문제점은 가지고 있었다. 그것은 model 선언이 비직관적이라는 것이다. 따라서 tensorflow는 keras를 공식 레포에 집어넣어 keras.layer로 모델을 만들고 tensorflow backend로 학습하는 구조로 발전했다.</p> <p>하지만 현재는 여러 연구에서 pytorch를 사용하고, pytorch 기반의 huggingface가 등장하면서 keras입장에서는 pytorch가 매력적인 시장으로 보였다. 그리고 tensorflow의 사용자가 줄어가고, 윈도우 네이티브 업데이트 지원을 종료하면서 다시 multi-backend의 강점을 다시 살리기로 했다.</p> <p align="center"> <img src="/assets/post/image/keras3/img.png" width="80%"> </p> <p align="center"> <img src="/assets/post/image/keras3/img_1.png" width="80%"> </p> <p>그래서 keras는 다음과 같은 기능을 강조하면서 keras3.0을 출시했다.</p> <h1 id="주요-기능">주요 기능</h1> <p>Keras 3.0을 출시하면서 다음과 같은 중요한 기능을 제시했다.</p> <ul> <li>The full Keras API, available for TensorFlow, JAX, and PyTorch</li> <li>A cross-framework low-level language for deep learning</li> <li>Seamless integration with native workflows in JAX, PyTorch, and TensorFlow</li> <li>Support for cross-framework data pipelines with all backends</li> <li>A new distribution API for large-scale data parallelism and model parallelism</li> <li>Pretrained models</li> <li>Progressive disclosure of complexity</li> <li>A new stateless API for layers, models, metrics, and optimizers</li> </ul> <p>하나씩 살펴보자</p> <h2 id="the-full-keras-api-available-for-tensorflow-jax-and-pytorch">The full Keras API, available for TensorFlow, JAX, and PyTorch</h2> <p align="center"> <img src="/assets/post/image/keras3/img_3.png" width="80%"> </p> <p>keras로 선언된 모델과 함수들은 tensorflow, jax, pytorch에서 모두 사용가능하다. 즉, 3개의 프레임워크에서 모두 keras 함수를 사용할 수 있다는 것이다. 여기서 재밌는 점은 기존에 tf.keras로 선언된 모델도 jax, pytorch에서 실행 가능하다.</p> <h2 id="a-cross-framework-low-level-language-for-deep-learning">A cross-framework low-level language for deep learning</h2> <p align="center"> <img src="/assets/post/image/keras3/img_4.png" width="80%"> </p> <p>딥러닝 모델을 구성하다보면 matmul, stack 등 기본적인 연산자가 필요할 때 있다. 이럴때는 keras.ops를 사용하여 기본적인 연산자를 구성하면 tensorflow, jax, pytorch에서 모두 사용가능하다. 이 떄 keras는 두 가지를 중심으로 구현했다.</p> <ul> <li>Numpy에 관련한 연산자는 모두 구현한다. ex) ops.matmul, ops.sum, ops.stack, ops.einsum</li> <li>Neural-specific function을 구현한다. ex) ops.softmax, ops.binary_crossentropy, ops.conv</li> </ul> <h2 id="seamless-integration-with-native-workflows-in-jax-pytorch-and-tensorflow">Seamless integration with native workflows in JAX, PyTorch, and TensorFlow</h2> <p align="center"> <img src="/assets/post/image/keras3/img_5.png" width="80%"> </p> <p>Integration하다보면 기존의 training loop 등 workflow를 그대로 유지해야할 경우가 있다. 물론 keras3.0은 이 경우도 지원한다.</p> <blockquote> <ul> <li>Write a low-level JAX training loop to train a Keras model using an optax optimizer, jax.grad, jax.jit, jax.pmap.</li> <li>Write a low-level TensorFlow training loop to train a Keras model using tf.GradientTape and tf.distribute.</li> <li>Write a low-level PyTorch training loop to train a Keras model using a torch.optim optimizer, a torch loss function, and the torch.nn.parallel.DistributedDataParallel wrapper.</li> <li>Use Keras layers in a PyTorch Module (because they are Module instances too!)</li> <li>Use any PyTorch Module in a Keras model as if it were a Keras layer.</li> <li>etc.</li> </ul> </blockquote> <h2 id="a-new-distribution-api-for-large-scale-data-parallelism-and-model-parallelism">A new distribution API for large-scale data parallelism and model parallelism</h2> <p align="center"> <img src="/assets/post/image/keras3/img_7.png" width="80%"> </p> <p align="center"> <img src="/assets/post/image/keras3/img_8.png" width="80%"> </p> <p>keras에서는 여러 data parallelism을 제공한다. 단 두줄 만으로 분산학습이 된다는게 신기하긴 하다.</p> <h2 id="support-for-cross-framework-data-pipelines-with-all-backends">Support for cross-framework data pipelines with all backends</h2> <p>각 framework별로 다른 dataset 객체를 사용한다. Keras3.0은 이를 모두 지원한다.</p> <blockquote> <ul> <li>tf.data.Dataset pipelines: the reference for scalable production ML.</li> <li>torch.utils.data.DataLoader objects.</li> <li>NumPy arrays and Pandas dataframes.</li> <li>Keras’s own keras.utils.PyDataset objects.</li> </ul> </blockquote> <h2 id="pretrained-models">Pretrained models</h2> <p>Keras3.0은 다음과 같은 pretrained model을 지원한다.</p> <blockquote> <ul> <li>BERT</li> <li>OPT</li> <li>Whisper</li> <li>T5</li> <li>StableDiffusion</li> <li>YOLOv8</li> <li>SegmentAnything</li> <li>etc.</li> </ul> </blockquote> <h2 id="progressive-disclosure-of-complexity">Progressive disclosure of complexity</h2> <p align="center"> <img src="/assets/post/image/keras3/img_6.png" width="80%"> </p> <p>개발하다보면 pytorch lightening, pytorch ignite, tensorflow orbit등 disclosure를 위한 툴을 쓴 경험이 있을 것이다. Keras는 이것이 keras api의 핵심 디자인으로 삼았으며 이를 지원한다 한다. <del>그냥 다른거 쓸 것 같긴한데…</del></p> <h2 id="a-new-stateless-api-for-layers-models-metrics-and-optimizers">A new stateless API for layers, models, metrics, and optimizers.</h2> <p>함수형 프로그래밍을 좋아하는 사람을 위해 stateless한 함수들을 만들었다.</p> <blockquote> <ul> <li>All layers and models have a stateless_call() method which mirrors <strong>call</strong>().</li> <li>All optimizers have a stateless_apply() method which mirrors apply().</li> <li>All metrics have a stateless_update_state() method which mirrors update_state() and a stateless_result() method which mirrors result().</li> </ul> </blockquote> <h1 id="example">Example</h1> <p>Tensorflow는 기존의 방법과 동일해서 설명을 생략하겠다.</p> <h3 id="mnist-with-keras-vgg19-pytorch-beckend">MNIST with keras vgg19 (Pytorch Beckend)</h3> <script src="https://gist.github.com/wonbeomjang/e935128f7f55045ab2d08e091cc2b8e2.js"></script> <p>이렇게 하면 기존 tensorflow나 keras vgg를 weight를 포함하여 사용할 수 있다. 여기서 주의할 점은 dataset augmentation 부분에서 CHW를 HWC로 바꿔줘야한다는 것이다.</p> <h3 id="declare-pytorch-model-using-keras-application">Declare Pytorch Model Using Keras Application</h3> <script src="https://gist.github.com/wonbeomjang/c76b1da2952d231e209a0d03896c4aef.js"></script> <p>재밌는 것은 keras.layer가 torch.nn.Module과 호환이되어 다음과 같이 모델을 선언할 수 있다.</p> <h1 id="맺으며">맺으며</h1> <p>너무 많은 담기 그래서 이쯤으로 마치고, 더 많은 예제는 다음에 다루기로 하겠다.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/multimodal-vs-unimodal/">What Makes Multi-modal Learning Better than Single (Provably)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/tinyvit/">TinyViT</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/integral-neural-network/">Integral Neural Network</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/proper-use-classification-features-in-object-detection/">Proper Reuse of Image Classification Features Improves Object Detection</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/meta-pseudo-label/">Meta Pseudo Labels</a> </li> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"wonbeomjang/wonbeomjang.github.io","data-repo-id":"R_kgDOIsrE7Q","data-category":"Comments","data-category-id":"DIC_kwDOIsrE7c4CaZnD","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"ko",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Wonbeom Jang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: February 05, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>